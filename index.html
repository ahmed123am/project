<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Software Security</title>
    <!--render all elements normally-->
    <link rel="stylesheet" href="css/normalize.css">
    <!-- main template css file -->
    <link rel="stylesheet" href="css/main.css"/>
    <!-- font awesome library -->
    <link rel="stylesheet" href="css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap"
    rel="stylesheet">
</head>
<body>
    <div class="container">
        <form action="">
            <input class="input" type="text" placeholder="Enter Your Text " name="text"onkeyup="lettersOnly(this)" >
        </form>
        <div class="buttons">
            <div class="ceaser">
                <h3 class="main-title">Ceaser Cipher</h3>
                <input class="key k1" type="text" placeholder="Enter Your Key " onkeyup="numbersOnly(this)">
                <span class="ce">Encrption</span>
                <span class="cd">Decrption</span>
            </div>
            <div class="viginere">
                <h3 class="main-title">Viginere Cipher</h3>
                <input class="k2" type="text" placeholder="Enter Your Key " onkeyup="lettersOnly(this)">
                <span class="ve">Encrption</span>
                <span class="vd">Decrption</span>
            </div>
            <div class="affine">
                <h3 class="main-title">Affine Cipher</h3>
                <input class="key k3" type="text" placeholder="Enter Key1 " onkeyup="numbersOnly(this)">
                <input class="key k4" type="text" placeholder="Enter Key2 " onkeyup="numbersOnly(this)">
                <span class="ae">Encrption</span>
                <span class="ad">Decrption</span>
            </div>
        </div>
        <div class="result"></div>

    </div>
    <script src="main.js">
        let letters = "abcdefghijklmnopqrstuvwxyz";

let lettersArray = Array.from(letters);

let input = document.querySelector('.input');

let inputArray=  Array.from(input.value);

let key1 =  document.querySelector('.k1');
let key2 =  document.querySelector('.k2');
let key3 =  document.querySelector('.k3');
let key4 =  document.querySelector('.k4');
let key = document.querySelector('.key');

function lettersOnly(input){
    let regex=/[^a-z]/gi;
    input.value = input.value.replace(regex,"");
}
function numbersOnly(input){
    let regex=/[^0-9]/gi;

    input.value = input.value.replace(regex,"");
}

let result= [];

let final= document.querySelector('.result');

let btn1=  document.querySelector('.ce');
let btn2=  document.querySelector('.cd');
let btn3=  document.querySelector('.ve');
let btn4=  document.querySelector('.vd');
let btn5=  document.querySelector('.ae');
let btn6=  document.querySelector('.ad');



btn1.addEventListener('click', (e) => {
    if(input.value != "" && key1.value !=""){
        inputArray.forEach((e) =>{
            let indexLetter=(+lettersArray.indexOf(e) + +key1.value)%26;
            while(indexLetter>26){
                indexLetter-=26;
            }
            while(+indexLetter<0){
                indexLetter+=26;
            }
            let letterAfter= lettersArray[indexLetter];
            result=result.concat(letterAfter);
        });
    }
    final.innerHTML=`${result.join("")}`;
    key1.value = key1.value.replace(key1.value,"");
});

btn2.addEventListener('click', (e) => {
    if(input.value != "" && key1.value !=""){
        inputArray.forEach((e) =>{
            let indexLetter=(+lettersArray.indexOf(e) - +key1.value)%26;
            while(+indexLetter>26){
                indexLetter-=26;
            }
            while(+indexLetter<0){
                indexLetter+=26;
            }
            let letterAfter= lettersArray[indexLetter];
            result=result.concat(letterAfter);
        });
    }
    final.innerHTML=`${result.join("")}`;
    key1.value = key1.value.replace(key1.value,"");
});

let i=0 ;
btn3.addEventListener('click', (e) => {
    if(input.value != "" && key2.value !=""){
        inputArray.forEach((e) =>{
            let keyArray =  Array.from(key2.value);
            let indexLetter=(+lettersArray.indexOf(e) + +lettersArray.indexOf(keyArray[i]))%26;
            while(indexLetter>26){
                indexLetter-=26;
            }
            while(+indexLetter<0){
                indexLetter+=26;
            }
            let letterAfter= lettersArray[indexLetter];
            result=result.concat(letterAfter);
            i++;
        });
    }
    final.innerHTML=`${result.join("")}`;
    key2.value = key2.value.replace(key2.value,"");
});

btn4.addEventListener('click', (e) => {
    if(input.value != "" && key2.value !=""){
        inputArray.forEach((e) =>{
            let keyArray =  Array.from(key2.value);
            let indexLetter=(+lettersArray.indexOf(e) - +lettersArray.indexOf(keyArray[i]))%26;
            while(indexLetter>26){
                indexLetter-=26;
            }
            while(+indexLetter<0){
                indexLetter+=26;
            }
            let letterAfter= lettersArray[indexLetter];
            result=result.concat(letterAfter);
            i++;
        });
    }
    final.innerHTML=`${result.join("")}`;
    key2.value = key2.value.replace(key2.value,"");
});


btn5.addEventListener('click', (e) => {
    if(input.value != "" && key3.value !="" && key4.value !=""){
        let a=key3.value;
        let b=key4.value;
        let gcd=a;
        let zero=26%a;
        
        while(zero!=0){
            let gcdOld=gcd;
            gcd=zero;
            zero=gcdOld%zero;
        }
        if(gcd==1){
            inputArray.forEach((e) =>{
                let indexLetter=((+a * +lettersArray.indexOf(e)) + +b)%26;
                while(indexLetter>26){
                    indexLetter-=26;
                }
                while(+indexLetter<0){
                    indexLetter+=26;
                }
                let letterAfter= lettersArray[indexLetter];
                result=result.concat(letterAfter);
            });
        }
    final.innerHTML=`${result.join("")}`;
    key3.value = key3.value.replace(key3.value,"");
    key4.value = key4.value.replace(key4.value,"");
    }
});


btn6.addEventListener('click', (e) => {
    if(input.value !="" && key3.value !="" && key4.value !=""){
        let a=key3.value;
        let b=key4.value;
        let gcd=a;
        let zero=26%a;
        
        while(zero!=0){
            let gcdOld=gcd;
            gcd=zero;
            zero=gcdOld%zero;
        }

        if(gcd==1){
            inputArray.forEach((e) =>{
                let indexLetter=(modInverse(a,26) * (+lettersArray.indexOf(e) - +b))%26;
                while(indexLetter>26){
                    indexLetter-=26;
                }
                while(+indexLetter<0){
                    indexLetter+=26;
                }
                let letterAfter= lettersArray[indexLetter];
                result=result.concat(letterAfter);
            });
        }
    final.innerHTML=`${result.join("")}`;
    key3.value = key3.value.replace(key3.value,"");
    key4.value = key4.value.replace(key4.value,"");
    if(gcd!=1){
        final.innerHTML="gcd not equal 1 try again";
    }
    }
});

function modInverse(a, m) {
    // validate inputs
    [a, m] = [Number(a), Number(m)]
    if (Number.isNaN(a) || Number.isNaN(m)) {
      return NaN // invalid input
    }
    a = (a % m + m) % m
    if (!a || m < 2) {
      return NaN // invalid input
    }
    // find the gcd
    const s = []
    let b = m
    while(b) {
        [a, b] = [b, a % b]
        s.push({a, b})
    }
    if (a !== 1) {
      return NaN // inverse does not exists
    }
    // find the inverse
    let x = 1
    let y = 0
    for(let i = s.length - 2; i >= 0; --i) {
      [x, y] = [y,  x - y * Math.floor(s[i].a / s[i].b)]
    }
    return (y % m + m) % m
}
    </script>
</body>
</html>
